<div class='hidden' id='deployment_summary_clipping'>
From: {{abs_url}}
App URL: {{formatted_data.path}}
App IP: {{formatted_data.vip}}
Servers:
{{formatted_data.clippy.server_data}}
Databases:
{{formatted_data.clippy.database_data}}
Load balancers:
{{formatted_data.clippy.lb_data}}
Applications:
User:     {{formatted_data.username}}
Password: {{formatted_data.password}}
Priv Key: {{formatted_data.private_key}}
</div>

<div class="entries container-fluid" ng-init="load()">
  <div class="entry well">
    <div class="row-fluid">
      <div class="span2">
        <ul class="nav nav-list">
          <li class="nav-header">
            Commands
          </li>
          <li>
            <a ng-click="save()" tooltip="Save any edits of the JSON. The JSON on the right is editable!">
              <i class="icon-ok"></i>
              Save
            </a>
          </li>

          <li>
            <a ng-show="auth.is_admin()" ng-click="sync()" tooltip="Sync the deployment resources">
              <i class="icon-retweet"></i>
              Sync
            </a>
          </li>

          <li>
            <a ng-show="showCommands" ng-click="open_modal('delete_warning')" tooltip="Delete Resources and Deployment">
              <i class="icon-remove"></i>
              Delete
            </a>
            <a ng-hide="showCommands" tooltip="You must impersonate this user to use this" class="muted">
              <i class="icon-remove"></i>
              Delete
            </a>
            <!-- delete_warning -->
            <div modal="modal_window.delete_warning" close="close_modal('delete_warning')" options="modal_opts" tabindex="-1" role="dialog" aria-labelledby="warning_title" aria-hidden="true">
              <div class="modal-header">
                <h3 id="warning_title" class="alert alert-danger">Warning! Data Destructive Task</h3>
              </div>
              <div class="modal-body">
                <p>Deleting the deployment will also delete all resources and data in it.</p>
              </div>
              <div class="modal-footer">
                <button class="btn btn-primary" ng-click="delete_deployment()">Go ahead and Delete</button>
                <button class="btn" ng-click="close_modal('delete_warning')">Cancel</button>
              </div>
            </div>
          </li>

          <li>
            <a ng-show="showCommands" ng-click="open_modal('force_delete_warning')" tooltip="Delete Resources and Deployment even if status does not allow it">
              <i class="icon-remove"></i> Force Delete
            </a>
            <a ng-hide="showCommands" tooltip="You must impersonate this user to use this" class="muted">
              <i class="icon-remove"></i> Force Delete
            </a>
            <!-- forceDeleteWarning -->
            <div modal="modal_window.force_delete_warning" close="close_modal('force_delete_warning')" options="modal_opts" tabindex="-1" role="dialog" aria-labelledby="forceDeleteWarningLabel" aria-hidden="true">
              <div class="modal-header">
                <h3 id="forceDeleteWarningLabel" class="alert alert-danger">Warning! Data Destructive Task</h3>
              </div>
              <div class="modal-body">
                <p>Deleting the deployment will also delete all resources and data in it.</p>
                <p>A forced delete may also result in a deployment that is broken and in an indeterminate state.</p>
              </div>
              <div class="modal-footer">
                <button class="btn btn-primary" href="#" ng-click="delete_deployment('1')">Go ahead and Force Delete</button>
                <button class="btn" ng-click="close_modal('force_delete_warning')">Cancel</button>
              </div>
            </div>
          </li>

          <li class="nav-header">
            Workflows
          </li>
          <li ng-repeat="operation in data['operations-history'].reverse() | filter:{ link: '!canvas' }">
            <a href="{{operation.link}}">{{operation.type | capitalize}}</a>
          </li>
          <li>
            <a href="{{data.operation.link}}">{{data.operation.type | capitalize}}</a>
          </li>
        </ul>
      </div>

      <div class="span10 deployment_container" style="background-position: right top; background-repeat: no-repeat; background-size: auto 140px; background-image: url({{data.blueprint['meta-data']['reach-info'].tattoo}})">
        <div class="page-header">
          <p>CLOUD DEPLOYMENT</p>
          <h3 style="display: inline">{{data.name || data.blueprint.name}}  </h3>
        </div>

        <div class="pull-right">
          <cm-tree-view data="tree_data" id="deployment_tree" width="256" height="256"></cm-tree-view>

          <div class="dropdown offset3" ng-show="data.status == 'UP' && available_services(data).length > 0">
            <button class="dropdown-toggle btn">
              <i class="icon-plus-sign action action-add"></i>
              Add Nodes
            </button>
            <ul class="dropdown-menu" ng-init="num_nodes=1">
              <li class="nav-header" cm-stop-click-propagation>
                Service: <br />
                <div ng-repeat="service in available_services(data)">
                  <input ng-model="$parent.selected_service" name="service" value="{{service}}" type="radio" /> {{service | capitalize}}<br />
                <div>
              </li>

              <li class="nav-header" cm-stop-click-propagation>
                Number of Nodes: <br />
                <input ng-model="num_nodes" type="number" min="1" max="8" class="span12" />
              </li>

              <li class="nav-header">
                <button class="btn btn-primary" ng-click="add_nodes(data, selected_service, num_nodes)">Add resources</button>
              </li>
            </ul>
          </div>
        </div>

        <div>
          <div class="lead pull-left">{{data.blueprint['meta-data']['application']}} Details</div>
        </div>
        <form class="form-horizontal">
          <fieldset>
            <div class="control-group">
              <label class="control-label" for="status">Status</label>
              <div class="controls">
                <span id="status" class="label" ng-class="{
                  'label-info': data.status == 'PLANNED',
                  'label-success': data.status == 'UP' || data.status == 'LAUNCHED' || data.status == 'ACTIVE',
                  'label-warning': data.status == 'ALERT' || data.status == 'DELETING' || data.status == 'BUILD',
                  'label-important': data.status == 'FAILED' || data.status == 'UNREACHABLE' || data.status == 'DOWN',
                  'label-inverse': data.status == 'DELETED'
                }">
                  {{data.display_status}}
                </span>

                <span ng-show="is_resumable()"><a href="#" ng-click="resume()">Resume</a></span>
                <span ng-show="is_resumable() && is_retriable()"> &#8226; </span>
                <span ng-show="is_retriable()"><a href="#" ng-click="retry()">Retry</a></span>
              </div>
            </div>

            <div ng-show="shouldDisplayWorkflowStatus()">
              <div class="control-group" ng-show="timeRemaining">
                <label class="control-label">Progress:</label>
                <div class="controls progress">
                  <div class="bar" style="width: {{percentComplete}}%;"></div>
                </div>
                <div class="controls">
                  <p><span class="label label-info">{{count}}</span> tasks total:</p>
                  <p>&nbsp; &nbsp; &nbsp;<span class="label label-success">{{taskStates['completed'] + taskStates['ready']}}</span> completed</p>
                  <p>&nbsp; &nbsp; &nbsp;<span class="label label-warning">{{taskStates['waiting']}}</span> in progress</p>
                  <p>&nbsp; &nbsp; &nbsp;<span class="label label-important">{{taskStates['error']}}</span> errored out</p>
                  <p>&nbsp; &nbsp; &nbsp;<span class="label">{{taskStates['future'] + taskStates['likely'] +
                  taskStates['maybe']}}</span> tasks waiting on other tasks to finish.</p>
                </div>
                &nbsp;
                <a style="margin-bottom: 15px;" class="btn" ng-show="data.id == 'simulate'" href="./status?complete">Complete the Simulation Now</a>
                <div class="alert controls">You can access an <a ng-href="/{{data.tenantId}}/workflows/{{data.id}}">advanced</a> view of
                the workflow to manage any errors or hack at the workflow.</div>
              </div>
            </div>


            <div class="control-group">
              <label class="control-label" for="secrets">Secrets:</label>
              <div class="controls" ng-switch="data.secrets">
                <div ng-switch-when="AVAILABLE"><a href="#" ng-click="showSecrets()">Secrets available</a></div>
                <div ng-switch-when="LOCKED"><i class="icon-lock"></i> dismissed</div>
                <div ng-switch-when="GENERATING">available soon</div>
                <div ng-switch-default>No secrets</div>
              </div>
            </div>

            <div class="control-group" ng-repeat="(name, output) in data['display-outputs']" ng-hide="output['is-secret']">
              <label class="control-label" for="{{'output' + $index}}">{{name}}</label>
              <div class="controls">
                <input type="text" readonly id="{{'output' + $index}}" value="{{output.value.url ||output.value}}">
              </div>
            </div>

            <hr>

            <div class="control-group">
              <label class="control-label" for="environment">Environment:</label>
              <div class="controls">
                <span class='deploy-value'>{{data.environment.name}}</span>
              </div>
            </div>

            <div class="control-group">
              <label class="control-label" for="environment">Blueprint:</label>
              <div class="controls">
                <span class='deploy-value'>{{data.blueprint.name}}</span>
              </div>
            </div>

            <div class="control-group">
              <label class="control-label" for="created">Created:</label>
              <div class="controls">
                <span class='deploy-value'>{{data.created | formattedFullDate}}</span>
              </div>
            </div>

            <div class="control-group">
              <label class="control-label" for="created-by">Created By:</label>
              <div class="controls">
                <span class='deploy-value'>{{data['created-by']}}</span>
              </div>
            </div>
          </fieldset>
        </form>

        <hr>

        <ng-include src="'/partials/deployments/_infrastructure.html'"></ng-include>

        <hr>

        <ng-include src="'/partials/deployments/_raw_source.html'"></ng-include>

      </div>
    </div>
  </div>
</div>
