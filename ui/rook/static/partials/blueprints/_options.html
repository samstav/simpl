<!-- Options header -->
<div class="row-fluid">
  <img class="span2" style="width: 60px; height: 60px;" src="/img/control-panel-icon.png"/>
  <div class="control-group span10">
    <legend>Options</legend>
  </div>
</div>

<div class="row-fluid" ng-show="options_to_display.length > 0" ng-repeat="opt in options_to_display">
  <div class="control-group span10">
    <h4>{{option_headers[opt] | capitalizeAll}}</h4>
    <span ng-show="!option_groups[opt]">No options available</span>
    <cm-option ng-repeat="option in option_groups[opt] | orderBy:'order'" />
  </div>
</div>

<!-- Templates -->
<script id="option-string" type="text/ng-template">
  <div class="control-group" ng-class="{error: (option.invalid || subForm.$invalid) &amp;&amp; subForm.$dirty}" ng-form="subForm">
    <label class="control-label capitalize" ng-class="{required: option.required}" for="{{option.id}}">{{option.label || option.id}}</label>
    <div class="controls">
      <input ng-if="!option.choice" type="text" class="input-xlarge" id="{{option.id}}" ng-model="inputs[option.id]"
              ng-required="option.required" ng-pattern="{{option.regex || ''}}"
              placeholder="{{option.sample | prepend:'ex. '}}" validate-option="option">
      <select ng-if="option.choice &amp;&amp; !option.choice[0].name" id="{{option.id}}" ng-model="inputs[option.id]" ng-required="option.required" ng-options="o for o in option.choice">
      </select>
      <select ng-if="option.choice[0].name" id="{{option.id}}" ng-model="inputs[option.id]" ng-required="option.required" ng-options="o.value as o.name for o in option.choice">
      </select>
      <i class="icon-question-sign" popover-html-unsafe="{{ option.constraints | cm_validation_rules }}" ng-show="option.constraints"></i>
      <p ng-hide="!option.description" class="help-block">{{option.description}}</p>
    </div>
  </div>
</script>

<script id="option-password" type="text/ng-template">
  <div class="control-group" ng-class="{error: (option.invalid || subForm.$invalid) &amp;&amp; subForm.$dirty}" ng-init="show=false" ng-form="subForm">
    <label class="control-label capitalize" ng-class="{required: option.required}" for="{{option.id}}">{{option.label || option.id}}</label>
    <div class="controls">
      <div class="input-append">
        <input ng-hide="show" type="password" class="input-large" name="{{option.id}}_safe" ng-model="inputs[option.id]"
                ng-required="required &amp;&amp; option.default != '=generate_password()'" ng-pattern="{{option.regex || ''}}" validate-option="option"
                placeholder="{{option.sample | prepend:'ex. '}}">
        <input ng-show="show" type="text" class="input-large" name="{{option.id}}_unsafe" ng-model="inputs[option.id]"
                ng-required="required &amp;&amp; option.default != '=generate_password()'" ng-pattern="{{option.regex || ''}}" validate-option="option"
                placeholder="{{option.sample | prepend:'ex. '}}">
        <button class="btn" ng-class="{'active': show}" ng-click="show = !show">Show</button>
        <button ng-click="inputs[option.id]=generatePassword();subForm.$dirty=true;" class="btn">Generate</button>
      </div>
      <i class="icon-question-sign" popover-html-unsafe="{{ option.constraints | cm_validation_rules }}" tooltip-animation="false" ng-show="option.constraints"></i>
      <p ng-hide="!option.description" class="help-block">{{option.description}} Click the generate button to generate a random password.
      </p>
    </div>
  </div>
</script>

<script id="option-text" type="text/ng-template">
  <div class="control-group" ng-class="{error: (option.invalid || subForm.$invalid) &amp;&amp; subForm.$dirty}" ng-form="subForm">
    <label class="control-label capitalize" ng-class="{required: option.required}" for="{{option.id}}">{{option.label || option.id}}</label>
    <div class="controls">
      <textarea cols="80" rows="20" class="input-xlarge ng-model" id="{{option.id}}" ng-model="inputs[option.id]"
              ng-required="option.required" ng-pattern="{{option.regex || ''}}" placeholder="{{option.sample | prepend:'ex. '}}">{{option.default}}</textarea>
      <p ng-hide="!option.description" class="help-block">{{option.description}}</p>
    </div>
  </div>
</script>

<script id="option-integer" type="text/ng-template">
  <div class="control-group" ng-class="{error: (option.invalid || subForm.$invalid) &amp;&amp; subForm.$dirty}" ng-form="subForm">
    <label class="control-label capitalize" ng-class="{required: option.required}" for="{{option.id}}">{{option.label || option.id}}</label>
    <div class="controls">
      <input ng-if="!option.choice" type="number" class="input-small" id="{{option.id}}" ng-model="inputs[option.id]"
              ng-required="option.required" ng-pattern="{{option.regex || ''}}"
              placeholder="{{option.sample | prepend:'ex. '}}" >
      <select ng-if="option.choice &amp;&amp; !option.choice[0].name" id="{{option.id}}" ng-model="inputs[option.id]" ng-required="option.required" ng-options="o for o in option.choice">
      </select>
      <select ng-if="option.choice[0].name" id="{{option.id}}" ng-model="inputs[option.id]" ng-required="option.required" ng-options="o.value as o.name for o in option.choice">
      </select>
      <p ng-hide="!option.description" class="help-block">{{option.description}}</p>
    </div>
  </div>
</script>

<script id="option-boolean" type="text/ng-template">
  <div class="control-group" ng-class="{error: (option.invalid || subForm.$invalid) &amp;&amp; subForm.$dirty}" ng-form="subForm">
    <label class="control-label capitalize" ng-class="{required: option.required}" for="{{option.id}}">{{option.label || option.id}}</label>
    <div class="controls">
      <label class="checkbox">
        <input type="checkbox" class="input-xlarge" id="{{option.id}}" ng-model="inputs[option.id]" ng-required="option.required" >
        {{description}}
      </label>
    </div>
  </div>
</script>

<script id="option-url" type="text/ng-template">
  <div ng-init="builder=false;UpdateParts(this, option.id);url=inputs[option.id].url || inputs[option.id]" ng-form="subForm">
    <div class="row-fluid">
      <div class="control-group" ng-class="{error: (option.invalid || subForm.$invalid) &amp;&amp; subForm.$dirty}">
        <label class="control-label" ng-class="{required: option.required}" for="{{option.id}}">{{option.label}}</label>
        <div class="controls">
          <div class="input-append span12">
            <input class="input-xlarge span9" ng-model="url" id="{{option.id}}" type="url" ng-change="UpdateParts(this, option.id);UpdateURLOption(this, option.id)" placeholder="{{option.sample | prepend:'ex. '}}" validate-option="option">
            <button class="btn" ng-class="{'active': builder}" ng-click="builder = !builder">Address Details</button>
            <i class="icon-question-sign" popover-html-unsafe="{{ option.constraints | cm_validation_rules }}" tooltip-animation="false" ng-show="option.constraints"></i>
          </div>
        </div>
      </div>
    </div>
    <div id="url_controls_for_{{option.id}}" ng-show="builder" class="well offset1">
      <!-- protocol -->
      <div class="row-fluid">
        <div class="control-group">
          <label class="control-label required" for="protocol_for_{{option.id}}">Protocol</label>
          <div class="controls">
            <select style="width:150px;" id="protocol_for_{{option.id}}" ng-options="o for o in option.protocols || ['http']" ng-model="protocol" ng-change="UpdateURL(this, option.id)"></select>
          </div>
        </div>
      </div>

      <!-- domain -->
      <div class="row-fluid">
        <div class="control-group">
          <label class="control-label required" for="domain_for_{{option.id}}">Domain</label>
          <div class="controls">
            <div class="input-append">
              <div class="btn-group">
                <input type="text" ng-model="domain" typeahead="domain for domain in domain_names | filter:$viewValue" placeholder="example.com" ng-change="UpdateURL(this, option.id)" />
                <button class="btn dropdown-toggle" type="button"><b class="caret"></b></button>
                <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                  <li ng-hide="auth.identity.loggedIn"><a href="#" ng-click="loginPrompt()">Log in (to see your domains)</a></li>
                  <li ng-show="domain_names==[]"><i class="icon-question-sign"></i> No domains registered for account {{auth.context.tenantId}}</li>
                  <li ng-repeat="o in domain_names"><a href="#" ng-click="$parent.domain=o;UpdateURL($parent, option.id)">{{o}}</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- register DNS -->
      <div class="row-fluid">
        <div class="control-group" ng-repeat="dns_option in options | filter:{id: 'register-dns'}">
          <label class="control-label required" for="register_dns">{{dns_option.label || id}}</label>
          <div class="controls">
            <input type="checkbox" class="input-xlarge" id="register_dns" ng-model="inputs['register-dns']">
            <p ng-hide="!dns_option.description" class="help-block">{{dns_option.description}}</p>
          </div>
        </div>
      </div>

      <!-- path -->
      <div class="row-fluid">
        <div class="control-group">
          <label class="control-label required" for="path_for_{{option.id}}">Path</label>
          <div class="controls">
            <input style="width:80px;" type="text" name="path_for_{{option.id}}" class="input-xlarge" id="path_for_{{option.id}}" placeholder="ex. /blog" ng-model="path" ng-change="UpdateURL(this, option.id)">
          </div>
        </div>
      </div>

      <!-- New Certificate Format -->
      <div class="row-fluid" ng-show="AcceptsSSLCertificate(this)">
        <hr>
        <h6>SSL Certificate</h6>
        <p class="help-block">To generate internal certificates for testing, go to <a href="https://ssl.corp.rackspace.com/" target="_blank">https://ssl.corp.rackspace.com/</a></p>
        <br>

        <!-- Certificate -->
        <div class="row-fluid">
          <div class="control-group">
            <label class="control-label capitalize" for="ssl_certificate">SSL Certificate</label>
            <div class="controls">
              <textarea rows="3" class="input-xlarge" id="ssl_certificate" ng-model="certificate" ng-change="UpdateURL(this, option.id)" placeholder="Ex. ----- BEGIN CERTIFICATE ----- ..."></textarea>
            </div>
          </div>
        </div>

        <!-- Private Key -->
        <div class="row-fluid">
          <div class="control-group">
            <label class="control-label capitalize" for="private_key">Private Key</label>
            <div class="controls">
              <textarea rows="3" class="input-xlarge" id="private_key" ng-model="private_key" ng-change="UpdateURL(this, option.id)" placeholder="Ex. ----- BEGIN PRIVATE KEY ----- ..."></textarea>
            </div>
          </div>
        </div>

        <!-- Intermediate Key -->
        <div class="row-fluid">
          <div class="control-group">
            <label class="control-label capitalize" for="intermediate_key">Intermediate Key</label>
            <div class="controls">
              <textarea rows="3" class="input-xlarge" id="intermediate_key" ng-model="intermediate_key" ng-change="UpdateURL(this, option.id)" placeholder="Ex. ----- BEGIN CERTIFICATE ----- ..."></textarea>
            </div>
          </div>
        </div>

      </div>

      <!-- LEGACY FIELDS -->
      <!-- ssl certificate -->
      <div class="row-fluid">
        <div class="control-group offset1" ng-show="ShowCerts()" ng-repeat="option in options | filter:{id: 'ssl_certificate'}">
          <label class="control-label capitalize" for="ssl_certificate">{{option.label}}</label>
          <div class="controls">
            <textarea cols="80" rows="20" class="input-xlarge" id="ssl_certificate" ng-model="inputs['ssl_certificate']" placeholder="{{option.sample | prepend:'ex. '}}"></textarea>
            <p class="help-block">{{option.description}} To generate internal certificates for testing, go to <a href="https://ssl.corp.rackspace.com/" target="_blank">https://ssl.corp.rackspace.com/</a></p>
          </div>
        </div>
      </div>

      <!-- ssl key -->
      <div class="row-fluid">
        <div class="control-group offset1" ng-show="ShowCerts()" ng-repeat="option in options | filter:{id: 'ssl_private_key'}">
          <label class="control-label capitalize" for="ssl_certificate">{{option.label}}</label>
          <div class="controls">
            <textarea cols="80" rows="20" class="input-xlarge" id="ssl_private_key" ng-model="inputs['ssl_private_key']" placeholder="{{option.sample | prepend:'ex. '}}"></textarea>
            <p ng-hide="!option.description" class="help-block">{{option.description}}</p>
          </div>
        </div>
      </div>

      <!-- ssl CA certificate -->
      <div class="row-fluid">
        <div class="control-group offset1" ng-show="ShowCerts()" ng-repeat="option in options | filter:{id: 'ssl_intermediate_certificate'}">
          <label class="control-label capitalize" for="ssl_intermediate_certificate">{{option.label}}</label>
          <div class="controls">
            <textarea cols="80" rows="20" class="input-xlarge" id="ssl_intermediate_certificate" ng-model="inputs['ssl_intermediate_certificate']" placeholder="{{option.sample | prepend:'ex. '}}"></textarea>
            <p ng-hide="!option.description" class="help-block">{{option.description}}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</script>

<!-- prepare to deprecate -->
<script id="option-int" type="text/ng-template">
  <div class="control-group" ng-class="{error: (option.invalid || subForm.$invalid) &amp;&amp; subForm.$dirty}">
    <label class="control-label capitalize" ng-class="{required: option.required}" for="{{option.id}}">{{option.label || option.id}}</label>
    <div class="controls">
      <input type="number" class="input-small" id="{{option.id}}" ng-model="inputs[option.id]"
              ng-required="option.required" ng-pattern="{{option.regex || ''}}"
              placeholder="{{option.sample | prepend:'ex. '}}" >
      <p ng-hide="!option.description" class="help-block">{{option.description}}</p>
    </div>
  </div>
</script>

<script id="option-select" type="text/ng-template">
  <div class="control-group" ng-class="{error: (option.invalid || subForm.$invalid) &amp;&amp; subForm.$dirty}">
    <label class="control-label capitalize" ng-class="{required: option.required}" for="{{option.id}}">{{option.label || option.id}}</label>
    <div class="controls">
      <select id="{{option.id}}" ng-model="inputs[option.id]" ng-required="option.required" ng-options="o for o in option.choice">
      </select>
      <p ng-hide="!option.description" class="help-block">{{option.description}}</p>
    </div>
  </div>
</script>

<script id="option-select-kv" type="text/ng-template">
  <div class="control-group" ng-class="{error: (option.invalid || subForm.$invalid) &amp;&amp; subForm.$dirty}">
    <label class="control-label capitalize" ng-class="{required: option.required}" for="{{option.id}}">{{option.label || option.id}}</label>
    <div class="controls">
      <select id="{{option.id}}" ng-model="inputs[option.id]" ng-required="option.required" ng-options="o.value as o.name for o in option.choice">
      </select>
      <p ng-hide="!option.description" class="help-block">{{option.description}}</p>
    </div>
  </div>
</script>

<script id="option-combo" type="text/ng-template">
  <div class="control-group" ng-class="{error: (option.invalid || subForm.$invalid) &amp;&amp; subForm.$dirty}">
    <label class="control-label capitalize" ng-class="{required: option.required}" for="{{option.id}}">{{option.label || option.id}}</label>
    <div class="controls">
       <input type="text" name="state" class="input-xlarge" id="{{option.id}}" ng-model="inputs[option.id]"
              ng-required="option.required" ng-pattern="{{option.regex || ''}}"
              placeholder="{{option.sample | prepend:'ex. '}}"/>
       <br />
       <select name="s" id="{{option.id}}" ng-model="inputs[option.id]" ng-options="o for o in option.choice" onchange="document.ex.state.value=document.ex.s.options[document.ex.s.selectedindex].value;document.ex.s.value="""><option value="" selected="selected">
       </select>
      <p ng-hide="!option.description" class="help-block">{{option.description}}</p>
    </div>
  </div>
</script>
